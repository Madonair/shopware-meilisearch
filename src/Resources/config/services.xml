<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

  <services>

    <!-- Services -->
    <service id="Mdnr\Meilisearch\Framework\ClientFactory" public="true">
      <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService" />
    </service>
    <service id="MeiliSearch\Client" public="true" lazy="true">
      <factory service="Mdnr\Meilisearch\Framework\ClientFactory" method="createClient" />


    </service>
    <service id="Mdnr\Meilisearch\Framework\Indexing\IndexCreator">
      <argument type="service" id="MeiliSearch\Client"/>
      <argument type="service" id="Mdnr\Meilisearch\Framework\MeilisearchRegistry"/>
    </service>
    <service id="Mdnr\Meilisearch\Framework\Indexing\MeilisearchIndexer">
      <argument type="service" id="Doctrine\DBAL\Connection"/>
      <argument type="service" id="Mdnr\Meilisearch\Framework\Indexing\IndexCreator"/>
      <argument type="service" id="Shopware\Core\Framework\DataAbstractionLayer\Dbal\Common\IteratorFactory"/>
      <argument type="service" id="Mdnr\Meilisearch\Framework\MeilisearchHelper"/>
      <argument type="service" id="Mdnr\Meilisearch\Framework\MeilisearchRegistry"/>
      <argument type="service" id="MeiliSearch\Client"/>
      <argument type="service" id="logger"/>
      <argument type="service" id="currency.repository"/>
      <argument type="service" id="language.repository"/>
      <argument type="service" id="event_dispatcher"/>
      <argument>100</argument>
      <tag name="messenger.message_handler"/>
    </service>
    <service id="Mdnr\Meilisearch\Framework\MeilisearchHelper" public="true">
      <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService" />
    </service>
    <service id="Mdnr\Meilisearch\Framework\MeilisearchRegistry">
      <argument type="tagged" tag="meilisearch.definition"/>
    </service>
    <service id="Mdnr\Meilisearch\Framework\Product\MeilisearchProductDefinition">
      <argument type="service" id="Shopware\Core\Content\Product\ProductDefinition"/>
      <argument type="service" id="product.repository"/>
      <tag name="meilisearch.definition"/>
    </service>
    <!-- Commands -->
    <service id="Mdnr\Meilisearch\Console\Command\MeilisearchCheckConnectionCommand">
      <tag name="console.command"/>
      <argument type="service" id="MeiliSearch\Client"/>
      <argument type="service" id="Mdnr\Meilisearch\Framework\MeilisearchHelper" />
      <argument type="service" id="Mdnr\Meilisearch\Framework\MeilisearchRegistry" />
      <argument type="service" id="Mdnr\Meilisearch\Framework\Indexing\MeilisearchIndexer" />
    </service>
  </services>
</container>